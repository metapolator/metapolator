#!/bin/sh
__hash_bang_trick=/* exec /usr/bin/env node --harmony "$0" "$@"  # -*- mode: javascript; -*- */undefined

"use strict";

exports.command = {
    description: 'Export a master to a UFO'
  , arguments: '<[project/]master> <ufo>'
};

var path = require('path');
var requirejs = require('requirejs');
require('rootpath')();
requirejs.config(require('config'));

if (require.main === module) {
    requirejs([
        'commander'
      , 'metapolator/parseArgs'
      , 'ufojs/tools/io/staticNodeJS'
      , 'metapolator/project/MetapolatorProject'
    ], function (
        program
      , parseArgs
      , io
      , MetapolatorProject
) {
        program._name = path.basename(process.argv[1]).replace('-', ' ');
        program.arguments(exports.command.arguments)
        .description(exports.command.description)
        .action(function(master, instance) {
            var pm = parseArgs.projectMaster(io, master);
            var project = pm[0];
            master = pm[1];
            project.load();
            
            // load all masters, because right now it is very confusing
            // when some masters are missing from the MOM
            project.masters.forEach(project.open, project);
            
            project.exportInstance(master, instance, program.precision);
        })
        .option('-p, --precision <n>', 'The number of decimal places to use in output coordinates, '
                                     + 'or -1 for no rounding',
                parseInt);
        program.parse(process.argv);
    }
)}
